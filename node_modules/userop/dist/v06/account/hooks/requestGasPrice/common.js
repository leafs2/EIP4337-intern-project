"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withEthClient = void 0;
const ethers_1 = require("ethers");
const withEthClient = (ethClient) => {
    if (ethClient instanceof ethers_1.JsonRpcProvider) {
        return async () => {
            const feeData = await ethClient.getFeeData();
            if (!feeData.maxFeePerGas || !feeData.maxPriorityFeePerGas) {
                return {
                    maxFeePerGas: feeData.gasPrice || 0n,
                    maxPriorityFeePerGas: feeData.gasPrice || 0n,
                };
            }
            return {
                maxFeePerGas: feeData.maxFeePerGas,
                maxPriorityFeePerGas: feeData.maxPriorityFeePerGas,
            };
        };
    }
    return async () => {
        const block = await ethClient.getBlock();
        if (!block.baseFeePerGas) {
            const gp = await ethClient.getGasPrice();
            return {
                maxFeePerGas: gp,
                maxPriorityFeePerGas: gp,
            };
        }
        const maxPriorityFeePerGas = await ethClient.estimateMaxPriorityFeePerGas();
        const maxFeePerGas = block.baseFeePerGas * 2n + maxPriorityFeePerGas;
        return {
            maxFeePerGas,
            maxPriorityFeePerGas,
        };
    };
};
exports.withEthClient = withEthClient;
